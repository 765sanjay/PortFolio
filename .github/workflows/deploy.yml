name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20.19.0'

      - name: Install Dependencies
        run: npm ci

      - name: Build
        run: npm run build

      - name: Add Security Headers
        run: |
          echo '/*' > dist/_headers
          echo '  Content-Security-Policy: default-src ''self''; script-src ''self'' ''unsafe-inline'' ''unsafe-eval''; style-src ''self'' ''unsafe-inline''; img-src ''self'' data: https:; font-src ''self'' data: https:;' >> dist/_headers
          echo '  X-Frame-Options: SAMEORIGIN' >> dist/_headers
          echo '  Permissions-Policy: camera=(), microphone=(), geolocation=()' >> dist/_headers
          echo '  X-Content-Type-Options: nosniff' >> dist/_headers
          echo '  Referrer-Policy: strict-origin-when-cross-origin' >> dist/_headers

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: dist